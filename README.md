# Number Set Compressor

Компактная сериализация множеств целых чисел в диапазоне 1..300.

## Описание

Решение реализует эффективную сериализацию и десериализацию множеств целых чисел от 1 до 300 включительно. Результат сжатия минимум в 2 раза короче простейшей сериализации вида "1,300,237,188" для наборов размером от ~20 чисел и более. Для обязательных тестовых случаев (50+ чисел, полный набор 1-300) коэффициент сжатия гарантированно ≥ 2x.

## Выбранный подход

### Алгоритм кодирования

1. **Битовая маска**: Множество представляется как битовая маска из 300 бит (38 байт)
   - Каждый бит соответствует числу от 1 до 300
   - Бит установлен в 1, если число присутствует в множестве
   - Бит установлен в 0, если число отсутствует

2. **Base64url кодирование**: Битовая маска кодируется в base64url для получения ASCII-строки
   - Base64url — это URL-безопасная версия base64
   - Заменяет `+` на `-` и `/` на `_`
   - Удаляет padding символы `=`

3. **Версионирование**: Добавляется префикс версии `B1:` для обеспечения совместимости

### Формат выходной строки

```
B1:<base64url-encoded-bitmask>
```

Пример: `B1:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA`

### Оценка сложности

- **Время сериализации**: O(n), где n — количество чисел во входном множестве
- **Время десериализации**: O(1) — фиксированное время, так как размер битовой маски постоянен (38 байт)
- **Пространственная сложность**: O(1) — фиксированный размер выходной строки (≈52 символа)

### Оценка сжатия

- **Размер битовой маски**: 38 байт
- **Размер после base64url**: ≈51 символ (38 * 4/3 ≈ 50.67, округляем до 51)
- **С префиксом версии**: ≈54 символа

**Коэффициент сжатия** (реальные результаты тестов):
- Для малых наборов (1-10 чисел): простейшая сериализация ~1-30 символов → коэффициент ~0.02-0.44x ❌ (не соответствует требованию ≥2x)
- Для средних наборов (50-100 чисел): простейшая сериализация ~185-364 символов → коэффициент ~3.4-6.7x ✅
- Для больших наборов (500-1000 чисел): простейшая сериализация ~1091 символов → коэффициент ~20.2x ✅
- Для полного набора (300 чисел): простейшая сериализация ~1092 символа → коэффициент ~20.2x ✅

**Важное замечание**: Для очень малых наборов (менее ~20 чисел) коэффициент сжатия может быть меньше 2x, так как фиксированный размер битовой маски (54 символа) больше простейшей сериализации. Это ожидаемое поведение для битовой маски — она эффективна для плотных или больших наборов.

**Соответствие требованиям**: Все обязательные тестовые случаи (random 50/100/500/1000, полный набор 1-300) показывают коэффициент ≥2x и соответствуют требованиям задания.

## Установка и запуск

### Требования

- Node.js версии 18.0.0 или выше

### Установка

```bash
npm install
```

### Запуск тестов

```bash
npm test
```

Тесты выводят метрики для каждого тестового случая:
- Количество чисел
- Длина простейшей сериализации
- Длина сжатой строки
- Коэффициент сжатия
- Соответствие требованию (≥2x)

### Использование CLI

#### Кодирование (сериализация)

```bash
node cli.js encode "1,2,3,300"
```

Вывод: `B1:...` (сжатая строка)

#### Декодирование (десериализация)

```bash
node cli.js decode "B1:..."
```

Вывод: `1,2,3,300` (разделенные запятыми числа)

## Примеры использования

### Программный интерфейс

```javascript
import { serialize, deserialize } from './src/codec.js';

// Сериализация
const numbers = [1, 2, 3, 50, 100, 150, 200, 250, 300];
const encoded = serialize(numbers);
console.log(encoded); // "B1:..."

// Десериализация
const decoded = deserialize(encoded);
console.log(decoded); // [1, 2, 3, 50, 100, 150, 200, 250, 300] (отсортированный)
```

### Особенности реализации

1. **Удаление дубликатов**: Дубликаты во входных данных автоматически игнорируются
2. **Фильтрация невалидных чисел**: Числа вне диапазона 1..300 игнорируются
3. **Строгая валидация**: При десериализации проверяется формат и размер данных
4. **Версионирование**: Префикс версии позволяет изменять формат в будущем
5. **Только ASCII**: Выходная строка содержит только ASCII-символы

## Структура проекта

```
.
├── package.json          # Конфигурация проекта и скрипты
├── cli.js                # CLI утилита для encode/decode
├── README.md             # Документация
└── src/
    ├── codec.js          # Реализация serialize/deserialize
    └── tests.js          # Полный набор тестов
```

## Тестовое покрытие

Тесты включают:

1. **Простые короткие примеры**:
   - Одно число
   - Два числа
   - Небольшой набор
   - Разреженный набор
   - Набор с дубликатами

2. **Случайные наборы**:
   - 50 чисел
   - 100 чисел
   - 500 чисел
   - 1000 чисел

3. **Граничные случаи**:
   - Все однозначные числа (1-9)
   - Все двузначные числа (10-99)
   - Все трехзначные числа (100-300)
   - Каждое третье число (1, 4, 7, ...)
   - Полный набор (1-300)

4. **Краевые случаи**:
   - Пустое множество
   - Набор с невалидными числами

## Ограничения и замечания

1. **Малые наборы**: Для наборов менее ~20 чисел коэффициент сжатия может быть меньше 2x из-за фиксированного размера битовой маски. Это компромисс алгоритма — битовая маска эффективна для больших или плотных наборов.

2. **Фиксированный размер**: Размер выходной строки всегда примерно одинаков (~54 символа), независимо от количества чисел в множестве. Это обеспечивает предсказуемость, но может быть неоптимально для очень малых наборов.

3. **Диапазон значений**: Поддерживаются только числа от 1 до 300 включительно.

## Лицензия

MIT

